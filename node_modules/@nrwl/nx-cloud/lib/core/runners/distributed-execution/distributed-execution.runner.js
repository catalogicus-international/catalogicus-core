const a8_0x5bbf=['exit','apply','toString','DistributedExecutionApi','value','Unable\x20to\x20download\x20','build','completedTasks','nodes','Waiter','defineProperty','createUnchangedValueTimeout','projectGraph','serializeOverrides','write','error','Extracting\x20artifacts','commandStatus','axiosException','readFileSync','../../file-storage/e2e-encryption','done','SIGTERM','target','terminalOutput','TaskGraphCreator','Main\x20job\x20was\x20terminated\x20via\x20SIGINT','splitTasksIntoStages','start','message','existsSync','Processing\x20task\x20','strip-json-comments','createTaskGraph','retrieve','../../api/error-reporter.api','SIGINT','completeRunGroupWithError','hash','log','find','VERBOSE_LOGGING','assign','../../../utilities/environment','printRunGroupError','note','/nx.json','Retrieving\x20artifacts\x20from\x20','startTask','FileStorage','See\x20run\x20details\x20at\x20','taskId','targetDependencies','getRunGroup','warn','scheduleTask','../../../utilities/nx-imports','../../../utilities/waiter','project','taskGraph','executionStatus','throw','lifeCycle','E2EEncryption','./distributed-execution.api','length','values','runUrl','Successfully\x20completed\x20running\x20the\x20command.','tasks','submitRunMetrics','createStartRequest','../../error/print-run-group-error','criticalErrorMessage','encryptionKey','../../../utilities/metric-logger','url','__awaiter','ENCRYPTION_KEY','Waiting...','configuration','Status\x20update','run','executionId:\x20','push','--skip-nx-cache\x20is\x20ignored\x20when\x20using\x20distributed\x20tasks\x20execution\x20(DTE).','dependencies','Distributed\x20Execution\x20Terminated','parse','Unable\x20to\x20complete\x20a\x20run.','Found\x20unknown\x20task:\x20','\x20seconds.','Main\x20job\x20was\x20terminated\x20via\x20SIGTERM','executionStatus:\x20','./split-task-graph-into-stages','./task-graph-creator','number\x20of\x20completed\x20tasks:\x20','addVerticalSeparator'];(function(_0x226c85,_0x5bbf15){const _0x34fa82=function(_0x420810){while(--_0x420810){_0x226c85['push'](_0x226c85['shift']());}};_0x34fa82(++_0x5bbf15);}(a8_0x5bbf,0xf4));const a8_0x34fa=function(_0x226c85,_0x5bbf15){_0x226c85=_0x226c85-0x0;let _0x34fa82=a8_0x5bbf[_0x226c85];return _0x34fa82;};'use strict';var __awaiter=this&&this[a8_0x34fa('0x1d')]||function(_0x2076fc,_0x5a60fa,_0x7a623b,_0x47856b){function _0x3ac67c(_0xef377b){return _0xef377b instanceof _0x7a623b?_0xef377b:new _0x7a623b(function(_0x3c9b98){_0x3c9b98(_0xef377b);});}return new(_0x7a623b||(_0x7a623b=Promise))(function(_0x308128,_0x3f030e){function _0x5e9aac(_0x379b0f){try{_0x16c02f(_0x47856b['next'](_0x379b0f));}catch(_0x27efe5){_0x3f030e(_0x27efe5);}}function _0x5c51b9(_0x1016b9){try{_0x16c02f(_0x47856b[a8_0x34fa('0xd')](_0x1016b9));}catch(_0x2ab666){_0x3f030e(_0x2ab666);}}function _0x16c02f(_0x295fd4){_0x295fd4[a8_0x34fa('0x47')]?_0x308128(_0x295fd4[a8_0x34fa('0x36')]):_0x3ac67c(_0x295fd4[a8_0x34fa('0x36')])['then'](_0x5e9aac,_0x5c51b9);}_0x16c02f((_0x47856b=_0x47856b[a8_0x34fa('0x33')](_0x2076fc,_0x5a60fa||[]))['next']());});};Object[a8_0x34fa('0x3c')](exports,'__esModule',{'value':!![]});exports['nxCloudDistributedTasksRunner']=void 0x0;const fs_1=require('fs');const stripJsonComments=require(a8_0x34fa('0x52'));const create_unchanged_value_timeout_1=require('../../../utilities/create-unchanged-value-timeout');const environment_1=require(a8_0x34fa('0x5d'));const metric_logger_1=require(a8_0x34fa('0x1b'));const serializer_overrides_1=require('../../../utilities/serializer-overrides');const waiter_1=require(a8_0x34fa('0x9'));const error_reporter_api_1=require(a8_0x34fa('0x55'));const print_run_group_error_1=require(a8_0x34fa('0x18'));const e2e_encryption_1=require(a8_0x34fa('0x46'));const file_storage_1=require('../../file-storage/file-storage');const distributed_execution_api_1=require(a8_0x34fa('0x10'));const split_task_graph_into_stages_1=require(a8_0x34fa('0x2e'));const task_graph_creator_1=require(a8_0x34fa('0x2f'));const {output,workspaceRoot,getOutputs,Cache}=require(a8_0x34fa('0x8'));class NoopLifeCycle{[a8_0x34fa('0x7')](_0x581425){}[a8_0x34fa('0x0')](_0x4b8665){}['endTasks'](_0x578138){}}function runDistributedExecution(_0x211bc9,_0x45e910,_0x2b27a6,_0x838ebb,_0x37e4f9,_0x4fd65b,_0xc4a9f){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x595e67=yield _0x211bc9[a8_0x34fa('0x4e')]((0x0,distributed_execution_api_1[a8_0x34fa('0x17')])(_0x4fd65b,(0x0,split_task_graph_into_stages_1[a8_0x34fa('0x4d')])(_0xc4a9f),_0x45e910));return yield processTasks(_0x211bc9,_0x838ebb,_0x37e4f9,_0x45e910,_0x595e67,Object[a8_0x34fa('0x12')](_0xc4a9f[a8_0x34fa('0x15')]),_0x2b27a6);});}function processTasks(_0x1e563f,_0x36597a,_0x15f737,_0x40caba,_0x34b085,_0x2a8853,_0x964c59){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x593e00={};const _0x3626fb=(0x0,create_unchanged_value_timeout_1[a8_0x34fa('0x3d')])({'title':'No\x20new\x20completed\x20tasks\x20after\x20'+environment_1['NO_COMPLETED_TASKS_TIMEOUT']/0x3e8+a8_0x34fa('0x2b'),'timeout':environment_1['NO_COMPLETED_TASKS_TIMEOUT']});const _0xd066af=new waiter_1[(a8_0x34fa('0x3b'))]();while(!![]){if(environment_1['VERBOSE_LOGGING']){output[a8_0x34fa('0x5f')]({'title':a8_0x34fa('0x1f')});}yield _0xd066af['wait']();const _0x4f9c8f=yield _0x1e563f['status'](_0x34b085);if(environment_1[a8_0x34fa('0x5b')]){output['note']({'title':a8_0x34fa('0x21'),'bodyLines':[a8_0x34fa('0x23')+_0x34b085,a8_0x34fa('0x2d')+_0x4f9c8f[a8_0x34fa('0xc')],a8_0x34fa('0x30')+_0x4f9c8f['completedTasks'][a8_0x34fa('0x11')],'error:\x20'+_0x4f9c8f[a8_0x34fa('0x19')]]});}if(_0x4f9c8f[a8_0x34fa('0x19')]){output[a8_0x34fa('0x41')]({'title':a8_0x34fa('0x27'),'bodyLines':['Error:',_0x4f9c8f[a8_0x34fa('0x19')]]});process[a8_0x34fa('0x32')](0x1);}_0x3626fb(_0x4f9c8f['completedTasks'][a8_0x34fa('0x11')]);for(const _0x3b52ac of _0x4f9c8f[a8_0x34fa('0x39')]){if(_0x593e00[_0x3b52ac[a8_0x34fa('0x3')]])continue;yield processTask(_0x36597a,_0x15f737,_0x964c59,_0x40caba,_0x2a8853,_0x3b52ac);_0xd066af['reset']();_0x593e00[_0x3b52ac[a8_0x34fa('0x3')]]=!![];}if(_0x4f9c8f[a8_0x34fa('0xc')]==='COMPLETED'){return{'commandStatus':_0x4f9c8f['commandStatus'],'runUrl':_0x4f9c8f[a8_0x34fa('0x13')]};}}});}function processTask(_0x174edc,_0x18f4b8,_0x145f9d,_0x54ecc7,_0x4a3c93,_0x14db67){return __awaiter(this,void 0x0,void 0x0,function*(){if(environment_1[a8_0x34fa('0x5b')]){output[a8_0x34fa('0x5f')]({'title':a8_0x34fa('0x51')+_0x14db67[a8_0x34fa('0x3')]});}const _0x49b13b=_0x4a3c93[a8_0x34fa('0x5a')](_0x54601e=>_0x14db67['taskId']===_0x54601e['id']);if(!_0x49b13b){throw new Error(a8_0x34fa('0x2a')+_0x14db67['taskId']);}if(environment_1['VERBOSE_LOGGING']){output[a8_0x34fa('0x5f')]({'title':a8_0x34fa('0x61')+_0x14db67[a8_0x34fa('0x1c')]});}const _0x465674=getOutputs(_0x145f9d[a8_0x34fa('0x3e')][a8_0x34fa('0x3a')],_0x49b13b);try{yield _0x174edc[a8_0x34fa('0x54')](_0x14db67[a8_0x34fa('0x58')],_0x14db67[a8_0x34fa('0x1c')],(0x0,environment_1['getNxCacheDirectory'])(_0x54ecc7));}catch(_0x39f70c){if(_0x465674[a8_0x34fa('0x11')]>0x0&&!_0x465674[a8_0x34fa('0x5a')](_0x43ed2a=>(0x0,fs_1[a8_0x34fa('0x50')])(_0x43ed2a))){throw _0x39f70c;}else{output[a8_0x34fa('0x6')]({'title':a8_0x34fa('0x37')+_0x14db67[a8_0x34fa('0x1c')]+'.\x20Hash:\x20'+_0x14db67[a8_0x34fa('0x58')],'bodyLines':['The\x20files\x20have\x20been\x20extracted\x20from\x20a\x20previous\x20command\x20invocation.']});}}const _0xac94ec=yield _0x18f4b8['get'](Object[a8_0x34fa('0x5c')](Object['assign']({},_0x49b13b),{'hash':_0x14db67['hash']}));if(environment_1[a8_0x34fa('0x5b')]){output['note']({'title':a8_0x34fa('0x42'),'bodyLines':_0x465674});}yield _0x18f4b8['copyFilesFromCache'](_0x14db67[a8_0x34fa('0x58')],_0xac94ec,_0x465674);output['logCommand'](getCommand(_0x49b13b));process['stdout'][a8_0x34fa('0x40')](_0xac94ec[a8_0x34fa('0x4a')]);output[a8_0x34fa('0x31')]();});}function getCommand(_0x1af8b8){const _0x4d65ec=_0x1af8b8[a8_0x34fa('0x49')][a8_0x34fa('0x20')]?':'+_0x1af8b8[a8_0x34fa('0x49')]['configuration']:'';return['nx',a8_0x34fa('0x22'),_0x1af8b8[a8_0x34fa('0x49')][a8_0x34fa('0xa')]+':'+_0x1af8b8['target'][a8_0x34fa('0x49')]+_0x4d65ec,(0x0,serializer_overrides_1[a8_0x34fa('0x3f')])(_0x1af8b8)]['join']('\x20');}function attachSignalListenersToCompleteRunGroupOnError(_0x4cf517,_0x12ee26){process['on'](a8_0x34fa('0x56'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x4cf517[a8_0x34fa('0x57')](_0x12ee26,a8_0x34fa('0x4c'));process[a8_0x34fa('0x32')](0x1);}));process['on'](a8_0x34fa('0x48'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x4cf517[a8_0x34fa('0x57')](_0x12ee26,a8_0x34fa('0x2c'));process[a8_0x34fa('0x32')](0x1);}));}const nxCloudDistributedTasksRunner=(_0x1c7872,_0x47cd24,_0x38a11e)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(_0x47cd24['skipNxCache']){output['warn']({'title':a8_0x34fa('0x25'),'bodyLine':['DTE\x20needs\x20the\x20cache\x20to\x20share\x20files\x20between\x20agents.']});}if(environment_1['VERBOSE_LOGGING']){output[a8_0x34fa('0x5f')]({'title':'Starting\x20distributed\x20command\x20execution'});}_0x47cd24[a8_0x34fa('0xe')]=new NoopLifeCycle();const _0x524a53=(0x0,environment_1[a8_0x34fa('0x5')])();if(!_0x524a53){(0x0,print_run_group_error_1[a8_0x34fa('0x5e')])();return process['exit'](0x1);}const _0x835510=new e2e_encryption_1[(a8_0x34fa('0xf'))](environment_1[a8_0x34fa('0x1e')]||_0x47cd24[a8_0x34fa('0x1a')]);const _0x4aabdb=new error_reporter_api_1['ErrorReporterApi'](_0x47cd24);const _0x4e51da=new file_storage_1[(a8_0x34fa('0x1'))](_0x835510,_0x4aabdb,!![],![]);const _0x10b07b=new Cache(_0x47cd24);const _0x325e62=new distributed_execution_api_1[(a8_0x34fa('0x35'))](_0x47cd24);attachSignalListenersToCompleteRunGroupOnError(_0x325e62,_0x524a53);try{const _0xdaa6fe=getTaskGraph(_0x38a11e,_0x1c7872,_0x47cd24);const _0x501892=yield runDistributedExecution(_0x325e62,_0x47cd24,_0x38a11e,_0x4e51da,_0x10b07b,_0x524a53,_0xdaa6fe);if(_0x501892[a8_0x34fa('0x43')]===0x0){output['success']({'title':a8_0x34fa('0x14'),'bodyLines':[a8_0x34fa('0x2')+_0x501892[a8_0x34fa('0x13')]]});}else{output[a8_0x34fa('0x41')]({'title':'Command\x20execution\x20failed.','bodyLines':[a8_0x34fa('0x2')+_0x501892[a8_0x34fa('0x13')]]});}yield(0x0,metric_logger_1[a8_0x34fa('0x16')])(_0x47cd24);process[a8_0x34fa('0x32')](_0x501892[a8_0x34fa('0x43')]);}catch(_0x2c37be){output[a8_0x34fa('0x41')]({'title':a8_0x34fa('0x29'),'bodyLines':[_0x2c37be[a8_0x34fa('0x4f')]]});if(_0x2c37be[a8_0x34fa('0x44')]){console['log'](_0x2c37be[a8_0x34fa('0x44')]);}else{console[a8_0x34fa('0x59')](_0x2c37be);}try{yield _0x325e62[a8_0x34fa('0x57')](_0x524a53,'Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22'+_0x2c37be['message']+'\x22');}finally{process[a8_0x34fa('0x32')](0x1);}}});exports['nxCloudDistributedTasksRunner']=nxCloudDistributedTasksRunner;function getTaskGraph(_0x5155e3,_0x55b478,_0x97611f){if(_0x5155e3[a8_0x34fa('0xb')]){return _0x5155e3['taskGraph'];}else{const _0x33f85f=JSON[a8_0x34fa('0x28')](stripJsonComments((0x0,fs_1[a8_0x34fa('0x45')])(workspaceRoot+a8_0x34fa('0x60'))[a8_0x34fa('0x34')]()));return new task_graph_creator_1[(a8_0x34fa('0x4b'))](_0x5155e3[a8_0x34fa('0x3e')],getDefaultDependencyConfigs(_0x33f85f,_0x97611f))[a8_0x34fa('0x53')](_0x55b478);}}function getDefaultDependencyConfigs(_0x5f5d56,_0x488eb0){var _0x564338,_0x4c6761;const _0x55921f=(_0x564338=_0x5f5d56[a8_0x34fa('0x4')])!==null&&_0x564338!==void 0x0?_0x564338:{};const _0x129ae2=_0x488eb0?(_0x4c6761=_0x488eb0['strictlyOrderedTargets'])!==null&&_0x4c6761!==void 0x0?_0x4c6761:[a8_0x34fa('0x38')]:[];for(const _0xcd6f6 of _0x129ae2){_0x55921f[_0xcd6f6]=_0x55921f[_0xcd6f6]||[];_0x55921f[_0xcd6f6][a8_0x34fa('0x24')]({'target':_0xcd6f6,'projects':a8_0x34fa('0x26')});}return _0x55921f;}